# This Source Code Form is subject to the terms of the Mozilla Public
# License, v. 2.0. If a copy of the MPL was not distributed with this
# file, You can obtain one at http://mozilla.org/MPL/2.0/.

####################################################################
# Classic IOS specific commands                                    #
####################################################################

- name: "IOS set hostname"
  cisco.ios.ios_hostname:
    config:
      hostname: "{{ inventory_hostname }}"
    state: replaced
  when: "'ios' in group_names"
  notify: 
    - ios_hostname

####################################################################
# IOSXE specific commands                                          #
####################################################################

- name: "IOS set hostname"
  cisco.ios.ios_hostname:
    config:
      hostname: "{{ inventory_hostname }}"
    state: replaced
  when: "'iosxe' in group_names"
  notify: 
    - ios_hostname

####################################################################
# IOSXR specific commands                                          #
####################################################################

# IOSXR is managed through netconf

####################################################################
# NXOS specific commands                                           #
####################################################################

- name: "NX-OS set hostname"
  cisco.nxos.nxos_hostname:
    config:
      hostname: "{{ inventory_hostname }}"
  when: "'nxos' in group_names"
  notify: 
    - nxos_hostname

####################################################################
# Netconf specific commands                                        #
####################################################################

- name: "Netconf set hostname"
  ansible.netcommon.netconf_config:
    content: "{{ lookup('template', 'iosxr_nc_hostname.j2') }}"
  when: "'iosxr' in group_names"
  notify: 
    - iosxr_hostname
    
####################################################################
# Kick off handlers for unit testing                               #
####################################################################
- name: force all notified handlers to run at this point, not waiting for normal sync points
  meta: flush_handlers